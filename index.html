<h1>Aisha</h1>
<pre id="messages" style="height: 700px; overflow: scroll"></pre>
<!-- <input type="text" id="messageBox" placeholder="Type your message here"
  style="display: block; width: 100%; margin-bottom: 10px; padding: 10px;" /> -->
<button id="join" title="Join Event!" style="width: 100%; height: 30px;">Join Event</button>
<button id="send" title="Send Message!" style="width: 100%; height: 30px;">Send Event</button>
<button id="getApp" title="Get Appointment" style="width: 100%; height: 30px;">Get Appointment</button>
<script src="./node_modules/socket.io/client-dist/socket.io.js"></script>

<script>
  (function () {
    const joinBtn = document.querySelector('#join');
    const sendBtn = document.querySelector('#send');
    const getAppBtn = document.querySelector('#getApp');
    const messages = document.querySelector('#messages');
    // const messageBox = document.querySelector('#messageBox');

    let ws;

    function showMessage(message) {
      messages.textContent += `\n\n${message}`;
      messages.scrollTop = messages.scrollHeight;
      // messageBox.value = '';
    }

    function init() {
      if (ws) {
        ws.onerror = ws.onopen = ws.onclose = null;
        ws.close();
      }

      // ws = new WebSocket('ws://localhost:3000');
      socket = io('ws://localhost:3000', { reconnect: true, transports: ['websocket'] });

      socket.on('connect', function (socket) {
        console.log('Connected!');
      });
      socket.on('message', (message) => {
        showMessage(message);
      })
    }

    sendBtn.onclick = function () {
      if (!socket) {
        showMessage("No WebSocket connection :(");
        return;
      }

    }


    joinBtn.onclick = function () {
      socket.emit('join-event', {
        event: 10,
        user: {
          id: 7,
          name: "Aisha",
        },
      });

      socket.on('send-event', () => {
        socket.emit('send-event', {
          event: 10,
          user: {
            id: 7,
            name: "Aisha",
          },
          users: [{
            id: 1,
            name: "Jameel"
          },
          {
            id: 24,
            name: "Sidrah"
          },
          {
            id: 12,
            name: "Khan"
          },
          {
            id: 7,
            name: "Aisha"
          },
          ],
          appointments: [{
            id: 1,
            time: "12/03/2021 16:45",
            sender: {
              id: 1,
              name: "Jameel"
            },
            recipient: {
              id: 24,
              name: "Sidrah"
            },
          },
          {
            id: 2,
            time: "12/03/2021 16:45",
            sender: {
              id: 12,
              name: "Khan",
            },
            recipient: {
              id: 7,
              name: "Aisha",
            },
          },
          {
            id: 3,
            time: "12/03/2021 16:40",
            sender: {
              id: 1,
              name: "Jameel",
            },
            recipient: {
              id: 7,
              name: "Aisha",
            },
          },
          {
            id: 4,
            time: "12/03/2021 16:40",
            sender: {
              id: 12,
              name: "Khan",
            },
            recipient: {
              id: 24,
              name: "Sidrah",
            },
          },
          ],
        })
      });
    }


    getAppBtn.onclick = function () {
      socket.emit('get-appointment-current', {
        event: 10,
        user: 7
      });

      socket.on('send-appointment', (app) => {
        if (app != null) {
          showMessage(app.id);
          showMessage(app.time);
          showMessage(app.sender.name);
          showMessage(app.recipient.name);
          showMessage('recieved appointment');
        } else {
          showMessage('No Active Appointment')
        }
      })
    }


    init();
  })();
</script>